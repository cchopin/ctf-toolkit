#!/usr/bin/env python3
"""
Script d'extraction du flag pour Shattered Tablet (HackTheBox)
Coller la sortie de : objdump -d tablet | grep -B1 "cmp.*\$0x"
"""

import re

data = """
  11c6:	0f b6 45 e2          	movzbl -0x1e(%rbp),%eax
  11ca:	3c 34                	cmp    $0x34,%al
--
  11d2:	0f b6 45 d4          	movzbl -0x2c(%rbp),%eax
  11d6:	3c 33                	cmp    $0x33,%al
--
  11de:	0f b6 45 e4          	movzbl -0x1c(%rbp),%eax
  11e2:	3c 72                	cmp    $0x72,%al
--
  11ea:	0f b6 45 c1          	movzbl -0x3f(%rbp),%eax
  11ee:	3c 54                	cmp    $0x54,%al
--
  11f6:	0f b6 45 d5          	movzbl -0x2b(%rbp),%eax
  11fa:	3c 76                	cmp    $0x76,%al
--
  1202:	0f b6 45 c6          	movzbl -0x3a(%rbp),%eax
  1206:	3c 30                	cmp    $0x30,%al
--
  120e:	0f b6 45 e7          	movzbl -0x19(%rbp),%eax
  1212:	3c 7d                	cmp    $0x7d,%al
--
  121a:	0f b6 45 e6          	movzbl -0x1a(%rbp),%eax
  121e:	3c 64                	cmp    $0x64,%al
--
  1226:	0f b6 45 df          	movzbl -0x21(%rbp),%eax
  122a:	3c 72                	cmp    $0x72,%al
--
  1232:	0f b6 45 dd          	movzbl -0x23(%rbp),%eax
  1236:	3c 33                	cmp    $0x33,%al
--
  123e:	0f b6 45 c8          	movzbl -0x38(%rbp),%eax
  1242:	3c 33                	cmp    $0x33,%al
--
  124a:	0f b6 45 d6          	movzbl -0x2a(%rbp),%eax
  124e:	3c 65                	cmp    $0x65,%al
--
  1256:	0f b6 45 e3          	movzbl -0x1d(%rbp),%eax
  125a:	3c 31                	cmp    $0x31,%al
--
  1262:	0f b6 45 c5          	movzbl -0x3b(%rbp),%eax
  1266:	3c 72                	cmp    $0x72,%al
--
  126e:	0f b6 45 c0          	movzbl -0x40(%rbp),%eax
  1272:	3c 48                	cmp    $0x48,%al
--
  127a:	0f b6 45 e0          	movzbl -0x20(%rbp),%eax
  127e:	3c 33                	cmp    $0x33,%al
--
  1286:	0f b6 45 d2          	movzbl -0x2e(%rbp),%eax
  128a:	3c 2e                	cmp    $0x2e,%al
--
  1292:	0f b6 45 cd          	movzbl -0x33(%rbp),%eax
  1296:	3c 34                	cmp    $0x34,%al
--
  129e:	0f b6 45 c3          	movzbl -0x3d(%rbp),%eax
  12a2:	3c 7b                	cmp    $0x7b,%al
--
  12aa:	0f b6 45 ca          	movzbl -0x36(%rbp),%eax
  12ae:	3c 5f                	cmp    $0x5f,%al
--
  12b6:	0f b6 45 d0          	movzbl -0x30(%rbp),%eax
  12ba:	3c 2e                	cmp    $0x2e,%al
--
  12c2:	0f b6 45 c4          	movzbl -0x3c(%rbp),%eax
  12c6:	3c 62                	cmp    $0x62,%al
--
  12ce:	0f b6 45 c7          	movzbl -0x39(%rbp),%eax
  12d2:	3c 6b                	cmp    $0x6b,%al
--
  12da:	0f b6 45 cf          	movzbl -0x31(%rbp),%eax
  12de:	3c 74                	cmp    $0x74,%al
--
  12e6:	0f b6 45 ce          	movzbl -0x32(%rbp),%eax
  12ea:	3c 72                	cmp    $0x72,%al
--
  12f2:	0f b6 45 d3          	movzbl -0x2d(%rbp),%eax
  12f6:	3c 6e                	cmp    $0x6e,%al
--
  12fa:	0f b6 45 d9          	movzbl -0x27(%rbp),%eax
  12fe:	3c 74                	cmp    $0x74,%al
--
  1302:	0f b6 45 d1          	movzbl -0x2f(%rbp),%eax
  1306:	3c 2e                	cmp    $0x2e,%al
--
  130a:	0f b6 45 c9          	movzbl -0x37(%rbp),%eax
  130e:	3c 6e                	cmp    $0x6e,%al
--
  1312:	0f b6 45 de          	movzbl -0x22(%rbp),%eax
  1316:	3c 5f                	cmp    $0x5f,%al
--
  131a:	0f b6 45 da          	movzbl -0x26(%rbp),%eax
  131e:	3c 30                	cmp    $0x30,%al
--
  1322:	0f b6 45 d8          	movzbl -0x28(%rbp),%eax
  1326:	3c 5f                	cmp    $0x5f,%al
--
  132a:	0f b6 45 cc          	movzbl -0x34(%rbp),%eax
  132e:	3c 70                	cmp    $0x70,%al
--
  1332:	0f b6 45 d7          	movzbl -0x29(%rbp),%eax
  1336:	3c 72                	cmp    $0x72,%al
--
  133a:	0f b6 45 dc          	movzbl -0x24(%rbp),%eax
  133e:	3c 62                	cmp    $0x62,%al
--
  1342:	0f b6 45 e1          	movzbl -0x1f(%rbp),%eax
  1346:	3c 70                	cmp    $0x70,%al
--
  134a:	0f b6 45 c2          	movzbl -0x3e(%rbp),%eax
  134e:	3c 42                	cmp    $0x42,%al
--
  1352:	0f b6 45 db          	movzbl -0x25(%rbp),%eax
  1356:	3c 5f                	cmp    $0x5f,%al
--
  135a:	0f b6 45 cb          	movzbl -0x35(%rbp),%eax
  135e:	3c 34                	cmp    $0x34,%al
--
  1362:	0f b6 45 e5          	movzbl -0x1b(%rbp),%eax
  1366:	3c 33                	cmp    $0x33,%al
"""

# Regex pour extraire offset et valeur
pattern = r"movzbl\s+-0x([0-9a-f]+).*?cmp.*?\$0x([0-9a-f]+)"
matches = re.findall(pattern, data, re.DOTALL)

resultats = []
for offset, valeur in matches:
    resultats.append((int(offset, 16), chr(int(valeur, 16))))

# Trier par offset decroissant (0x40 = position 0, 0x19 = derniere position)
resultats.sort(key=lambda x: x[0], reverse=True)

# Assembler le flag
flag = ""
for offset, char in resultats:
    flag += char

print(f"Flag : {flag}")
